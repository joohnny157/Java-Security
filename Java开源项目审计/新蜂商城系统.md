一、项目简介

Newbee-mall是一套电商系统，包括基础版本(Spring Boot+Thymeleaf)、前后端分离版本(Spring 
Boot+Vue 3+Element-Plus+Vue-Router 4+Pinia+Vant 4) 、秒杀版本、Go语言版本、微服务版本 
(Spring Cloud Alibaba+Nacos+Sentinel+Seata+Spring Cloud Gateway+OpenFeign+ELK)。 前台 
商城系统包含首页门户、商品分类、新品上线、首页轮播、商品推荐、商品搜索、商品展示、购物 
车、订单结算、订单流程、个人订单管理、会员中心、帮助中心等模块。 后台管理系统包含数据 
面板、轮播图管理、商品管理、订单管理、会员管理、分类管理、设置等模块。 
newbee-mall 对新手开发者十分友好，无需复杂的操作步骤，仅需 2 秒就可以启动这个完整 
的商城项目； 
newbee-mall 也是一个企业级别的 Spring Boot 大型项目，对于各个阶段的 Java 开发者都 
是极佳的选择； 
你可以把它作为 Spring Boot 技术栈的综合实践项目，newbee-mall 足够符合要求，且代码 
开源、功能完备、流程完整、页面交互美观； 
技术栈新颖且知识点丰富，学习后可以提升大家对于知识的理解和掌握，可以进一步提升你 
的市场竞争力； 
对于部分求职中的 Java 开发者，你也可以将该项目放入求职简历中以丰富你的工作履历；

二、代码审计漏洞挖掘

2.1、后台SQL注入漏洞
该项目为Mybatis持久层框架，在mybatis中存在两种拼接SQL语句的方法，一种是${ },一种是#{ }
#{  }是创建一个预编译语句参数，这种方法可以有效防止SQL注入漏洞。
${  }就只是一个string替换，在动态SQL解析的时候会进行变量替换，类似于直接替换字符串，这种方式会导致SQL注入漏洞的产生。

挖掘mybatis的SQL注入，可以在项目中全局搜索关键字${ 因为mybatis的映射文件都是xml结尾的，筛选即可
<img width="1707" height="864" alt="image" src="https://github.com/user-attachments/assets/879abdfb-5cd0-45c5-a061-600bc33836c8" />

<img width="2187" height="1470" alt="image" src="https://github.com/user-attachments/assets/50b5c779-8b40-4ac3-8ef1-f80cd79bdadb" />

跟踪箭头
<img width="1609" height="1180" alt="image" src="https://github.com/user-attachments/assets/7661f6e5-d88a-484b-93ad-de94e1e50489" />
ctrl+左键继续跟踪

<img width="2187" height="1470" alt="image" src="https://github.com/user-attachments/assets/06423921-0770-4418-a49e-e82a36435e8a" />

来到Controller层

<img width="2187" height="1470" alt="image" src="https://github.com/user-attachments/assets/642479ae-95ce-44c3-8437-5e21643c19fb" />

路由为/goods/list
来到web后台，商品管理

<img width="1788" height="1464" alt="image" src="https://github.com/user-attachments/assets/e0307627-10cc-474e-b9fe-78e33d3acc44" />

但是这里并没有goodsName这个参数
在后面添加一个试试，单引号报错

<img width="1788" height="1464" alt="image" src="https://github.com/user-attachments/assets/05ba7d26-8b68-4caa-8d17-85d972f565f3" />

<img width="1752" height="936" alt="image" src="https://github.com/user-attachments/assets/b1a45fa9-5e44-4ca3-8b9e-3bf7c2632395" />

验证成功，存在SQL注入漏洞

2.2、前台SQL注入漏洞

在全局搜索${ 拼接SQL语句的时候，除了goodsName还有一个keyword参数

<img width="1707" height="864" alt="image" src="https://github.com/user-attachments/assets/3a4dc417-d742-454c-a0f6-95f7d8670610" />

跟踪一下

<img width="2559" height="1539" alt="image" src="https://github.com/user-attachments/assets/bdf38166-30aa-4f5f-95e3-06f170d7f347" />

来到mapper层继续跟踪

<img width="1806" height="1470" alt="image" src="https://github.com/user-attachments/assets/0a3f0f7d-bd1a-4188-a3fb-c7a7a58a13ed" />

servic层
<img width="1806" height="1470" alt="image" src="https://github.com/user-attachments/assets/0107eff8-ac3b-49d6-9ce5-dd3e52952557" />

跟踪service层来到Controller层

<img width="2559" height="1539" alt="image" src="https://github.com/user-attachments/assets/1aa52292-a7df-4f90-9f15-05cbd14ed0f2" />

在GoodsController类中的searchpage方法调用了它
路由为/search 或/search.html
在mybatis封装的xml中，知道参数为keyword
那么payload就应该是 /search.html?keyword=  或者/search?keyword=

<img width="1752" height="936" alt="image" src="https://github.com/user-attachments/assets/6124dde8-cc2b-49a3-a0d8-4d39908af018" />

验证成功，存在SQL注入漏洞

2.3、后台权限绕过漏洞

在java中用于鉴权 过滤的通常是，filter过滤器，interceptor拦截器
该漏洞产生于/interceptor/AdminLoginInterceptor.java

<img width="2559" height="1539" alt="image" src="https://github.com/user-attachments/assets/d668fa5d-7a6b-4dba-8e17-864f0e2ae491" />

在这段代码中首先使用了getRequestURI来获取传入的路径
if判断 uri是否是以/admin开头的，并且判断session是否为空
如果是以/admin并且session为空的话那就提示 “请登录”并且重定向到/admin/login

在if判断中使用&&符号
那就表明，这里必须是要/admin，session为null，两个条件同时成立，才会跳转到登录页面
如果这两个条件中有一个不成立，那么就不会跳转。
在这里的session是没有办法操控的，现在只能在/admin条件做文章，
这里的条件是，如果uri是/admin开头的 就会跳转，
最终可以构造uri路径为 /;/admin/xxxx 或者 ///admin/xxxx
这样就不是以/amdin开头的了，并且 ; 和/ 不会影响目录结构的访问，从而绕过interceptor拦截器的权限校验

来到后台，随便点个功能抓包
<img width="2115" height="1485" alt="image" src="https://github.com/user-attachments/assets/3aa4992c-dc24-4ec6-8243-f46e321bc792" />

将cookie删除，现在就是两个条件同时成立了
一个/admin开头，一个是session为null
返回302，并且重定向到/admin/login 登录页面

<img width="2115" height="1485" alt="image" src="https://github.com/user-attachments/assets/71ddec1b-4614-4923-bc62-634474c99d0e" />

现在在uri前面加上/;/ 现在uri就不是以/admin开头的了，而是以/;/开头的。
在上面提到过，必须要两个条件同时成立才会跳转到登录页面，一个是/admin开头，一个是session为null。
现在这个session为空，但是/admin开头的这个条件已经不成立了，那么代码继续往下走
就返回来了我们后台的信息。
成功绕过了interceptor的身份校验

<img width="2115" height="1485" alt="image" src="https://github.com/user-attachments/assets/d6d6aa2e-e780-4b3b-a69c-63a72a02d17a" />

